<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python is a good visual primitive - Agents-X</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 页面特定样式 */
        :root {
            --primary-color-dark: #1d75a5;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #fff;
            margin: 0;
            padding: 0;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .article-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .header-nav {
            display: flex;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid #eaeaea;
            margin-bottom: 40px;
        }
        
        .home-link {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: var(--text-color);
            font-weight: 500;
            transition: color 0.2s;
        }
        
        .home-link:hover {
            color: var(--primary-color);
        }
        
        .home-link svg {
            width: 32px;
            height: 18px;
            margin-right: 8px;
        }
        
        .article-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .date-tag {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .date {
            font-size: 14px;
            color: var(--secondary-text-color);
        }
        
        .tag {
            font-size: 14px;
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .article-title {
            font-size: 40px;
            font-weight: 700;
            margin-bottom: 20px;
            line-height: 1.2;
        }
        
        .article-abstract {
            font-size: 16px;
            color: var(--secondary-text-color);
            max-width: 600px;
            margin: 0 auto 30px;
            text-align: left;
            background-color: #e9f4f8;
            padding: 20px;
            border-radius: 10px;
            font-style: italic;
        }
        
        .project-links {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 40px;
        }
        
        .project-link {
            display: inline-flex;
            align-items: center;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            transition: all 0.2s ease;
        }
        
        .project-link i {
            margin-right: 8px;
        }
        
        .project-link.github {
            background-color: #24292e;
            color: white;
        }
        
        .project-link.github:hover {
            background-color: #1a1e22;
        }
        
        .project-link.huggingface {
            background-color: #ee9a1b;
            color: white;
        }
        
        .project-link.huggingface:hover {
            background-color: #ce8f32;
        }
        
        .project-link.arxiv {
            background-color: #b31b1b;
            color: white;
        }
        
        .project-link.arxiv:hover {
            background-color: #9c1717;
        }
        
        .article-content {
            font-size: 17px;
            line-height: 1.7;
        }
        
        .article-content p {
            margin-bottom: 24px;
        }
        
        .article-section {
            margin: 60px 0;
        }
        
        .article-content h2 {
            font-size: 28px;
            font-weight: 700;
            margin: 40px 0 24px;
            scroll-margin-top: 80px;
        }
        
        .note {
            font-style: italic;
            color: var(--secondary-text-color);
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .feature-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 30px 0;
            scroll-margin-top: 80px;
        }
        
        .feature-button {
            background-color: var(--light-gray);
            border: none;
            border-radius: 20px;
            padding: 10px 18px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
        }
        
        .feature-button:hover {
            background-color: #e5e5e5;
        }
        
        .feature-button.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .reasoning-process {
            margin: 30px 0;
            border: 1px solid #eaeaea;
            border-radius: 8px;
            padding: 20px;
            background-color: #f9f9f9;
        }
        
        .reasoning-container {
            min-height: 200px;
        }
        
        .reasoning-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 16px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Navigation links for sections */
        .section-nav {
            position: fixed;
            left: calc(50vw - 600px); /* 靠近内容区，540=800/2+140，内容最大宽800px，nav宽约140px */
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        
        .section-link {
            font-size: 14px;
            font-weight: 500;
            color: var(--secondary-text-color);
            text-decoration: none;
            transition: color 0.2s;
            padding: 5px 10px;
            white-space: nowrap;
        }
        
        .section-link:hover, 
        .section-link.active {
            color: var(--primary-color);
            background: rgba(0, 0, 0, 0.05);
            border-radius: 5px;
        }
        
        /* Subsection navigation styling */
        .section-link[href^="#visual-puzzle"],
        .section-link[href^="#geography"],
        .section-link[href^="#medical"],
        .section-link[href^="#science"],
        .section-link[href^="#information"] {
            font-size: 12px;
            padding-left: 20px;
            color: #888;
        }
        
        /* 作者栏左右分栏布局 */
        .authors-section {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 40px;
            background: #f3f3f3;
            border-radius: 10px;
            padding: 24px 24px 24px 24px;
            margin: 20px 0 40px;
            border-bottom: 1px solid #eaeaea;
        }
        .authors-meta {
            flex: 2;
        }
        .authors-title, .affiliations-title, .published-title {
            color: #a0a0a0;
            font-size: 13px;
            font-weight: 500;
            letter-spacing: 1px;
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        .authors-list {
            display: block;
            font-size: 16px;
            font-weight: 400;
            color: #111;
            margin-bottom: 10px;
        }
        .author {
            font-size: 16px;
            font-weight: 400;
        }
        .author sup {
            font-size: 12px;
            color: #a4a4a4;
            font-weight: 600;
        }
        .author-note {
            font-size: 13px;
            color: #888;
            margin-top: 8px;
            font-style: normal;
            text-align: left;
        }
        .authors-right {
            flex: 1;
            min-width: 180px;
            text-align: left;
        }
        .affiliations-list {
            font-size: 16px;
            color: #111;
            margin-bottom: 16px;
        }
        .published-date {
            font-size: 16px;
            color: #111;
        }
        @media (max-width: 768px) {
            .authors-section {
                flex-direction: column;
                gap: 10px;
                text-align: left;
            }
            .authors-right {
                text-align: left;
                min-width: 0;
            }
        }
        
        /* 页脚样式 */
        footer {
            padding: 20px 0;
            margin-top: 60px;
            text-align: center;
        }
        
        .footer-content {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .footer-social {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .social-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            color: #666;
            transition: color 0.2s, transform 0.2s;
            font-size: 18px;
            background-color: #f5f5f5;
        }
        
        .social-icon:hover {
            color: var(--primary-color);
            transform: translateY(-3px);
            background-color: #eeeeee;
        }
        
        .copyright {
            font-size: 14px;
            color: #666;
        }

        /* code style */
        .bibtex-block {
            background: #f7f7fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 18px 18px 12px 18px;
            margin: 32px 0 32px 0;
            position: relative;
        }
        .bibtex-title {
            font-size: 16px;
            font-weight: 600;
            color: #444;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }
        .bibtex-pre {
            font-size: 14px;
            color: #333;
            background: none;
            border: none;
            padding: 0;
            margin: 0;
            font-family: 'Fira Mono', 'Consolas', 'Menlo', monospace;
            white-space: pre;
            line-height: 1.6;
            overflow-x: auto;
            word-break: normal;
        }
        .bibtex-copy-btn {
            position: absolute;
            top: 18px;
            right: 18px;
            background: #ededed;
            border: none;
            border-radius: 4px;
            padding: 4px 10px;
            font-size: 13px;
            color: #666;
            cursor: pointer;
            transition: background 0.2s;
        }
        .bibtex-copy-btn:hover {
            background: #e0e0e0;
            color: #222;
        }
        
        @media (max-width: 768px) {
            .article-title {
                font-size: 32px;
            }
            
            .feature-buttons {
                justify-content: center;
            }
            
            .authors-list {
                flex-direction: column;
                gap: 10px;
            }
        }

        @media (max-width: 1200px) {
            .section-nav {
                position: static;
                transform: none;
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                margin: 30px 0;
                padding: 15px 0;
                border-top: 1px solid #eaeaea;
                border-bottom: 1px solid #eaeaea;
                background: none;
                box-shadow: none;
                left: 0;
            }
            .article-container {
                padding-left: 0;
            }
        }
        
        /* Reasoning process styling */
        .reasoning-container {
            max-height: 600px;
            overflow-y: auto;
            padding: 16px;
            width: 100%;
        }
        
        .reasoning-error {
            padding: 20px;
            text-align: center;
            color: #d32f2f;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .error-icon {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .reasoning-message {
            margin-bottom: 16px;
            padding: 12px;
            border-radius: 6px;
            width: 100%;
            box-sizing: border-box;
        }
        
        .reasoning-user {
            background-color: #f1f5f9;
        }
        
        .reasoning-user strong {
            display: block;
            margin-bottom: 10px;
            color: #1d75a5;
            font-size: 1.1em;
        }
        
        .reasoning-assistant {
            background-color: #ffffff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        
        .reasoning-text {
            margin-bottom: 12px;
            line-height: 1.5;
        }
        
        .reasoning-code {
            margin: 12px 0;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .reasoning-code pre {
            margin: 0;
            padding: 12px;
            background-color: #2b2b2b;
            color: #f8f8f2;
            overflow-x: auto;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .reasoning-interpreter-output {
            margin: 12px 0;
            padding: 12px;
            background-color: #f7f7f9;
            border-left: 4px solid #8a8a8a;
            font-family: monospace;
            white-space: pre-wrap;
        }
        
        .reasoning-image-wrap {
            margin: 12px 0;
            text-align: center;
        }
        
        .reasoning-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .reasoning-image.enlarged {
            max-height: none;
            max-width: 90%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 10;
            position: relative;
        }
        
        .reasoning-answer {
            margin-top: 16px;
        }
        
        .answer-box {
            padding: 12px 16px;
            background-color: #e8f5e9;
            border: 1px solid #c8e6c9;
            border-radius: 6px;
            color: #388e3c;
            font-weight: 600;
        }
        
        .user-question {
            background-color: #e8f5fe;
            border-left: 4px solid #1d75a5;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        
        .user-question strong {
            display: block;
            color: #1d75a5;
            margin-bottom: 8px;
            font-size: 1.05em;
        }

        /* 对话气泡样式 */
        .bubble {
            max-width: 80%;
            padding: 14px 18px;
            border-radius: 18px;
            font-size: 16px;
            line-height: 1.6;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            word-break: break-word;
        }
        .bubble-gpt {
            background: #ffffff;
            color: #222;
            align-self: flex-start;
            border-top-left-radius: 6px;
            margin-right: auto;
        }
        .bubble-human {
            background: #f3f9ff;
            color: #1a3a5d;
            align-self: flex-end;
            border-top-right-radius: 6px;
            margin-left: auto;
        }
        .reasoning-message {
            display: flex;
            margin-bottom: 16px;
        }
        
        /* 新增：标识符样式 */
        .tag-indicator {
            font-family: 'Fira Mono', 'Consolas', 'Menlo', monospace;
            font-size: 12px;
            color: #666;
            background-color: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            margin: 2px 0;
            border: 1px solid #e0e0e0;
            display: inline-block;
        }
        
        .reasoning-code-block,
        .reasoning-image-block,
        .reasoning-interpreter-block,
        .reasoning-answer-block {
            margin: 12px 0;
            border: 1px solid #e8e8e8;
            border-radius: 6px;
            padding: 8px;
            background-color: #fafafa;
        }
        
        /* Category sections styling */
        .category-section {
            margin: 50px 0;
            border-bottom: 1px solid #eaeaea;
            padding-bottom: 40px;
        }
        
        .category-section:last-child {
            border-bottom: none;
        }
        
        .category-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary-color-dark);
        }
        
        .category-buttons {
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <header class="header-nav">
        <div class="container" style="justify-content: flex-start; display: flex;">
            <a href="index.html" class="home-link">
                <svg viewBox="0 0 188.09 78.7" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0,45.67v-12.65L50.59,0v16.56L14.9,39.09v.53l35.69,22.53v16.56L0,45.67Z" fill="#b3b3b3"/>
                    <path d="M83.68,37.22L68,0h19.78l5.69,15.69c1.16,3.2,2.68,8.7,4.06,12.95h.53c2.77-4.17,6.15-10.07,8.18-12.92L117.88,0h19.62l-32,39.88,16.96,38.82h-19.65l-6.53-17.04c-1.09-2.86-2.85-8.34-4.17-12.21h-.53c-2.82,4.29-6.01,9.18-8.4,12.42l-12.87,16.83h-19.72l33.09-41.48Z" fill="#000000"/>
                    <path d="M137.5,62.14l35.69-22.53v-.53l-35.69-22.52V0l50.59,33.02v12.65l-50.59,33.02v-16.56Z" fill="#b3b3b3"/>
                </svg>
                Back to Home
            </a>
        </div>
    </header>

    <main class="article-container">
        <article>
            <div class="article-header">
                <div class="date-tag">
                    <span class="date">May 24, 2025</span>
                    <span class="tag">Published</span>
                </div>
                <h1 class="article-title">Python is a good visual primitive</h1>
                <p class="article-abstract">
                    This study investigates the effectiveness of Python code as a visual primitive for image manipulation and reasoning. We demonstrate that GPT-4.1 can be directly prompted to generate code for image modifications, offering a novel approach to addressing complex Visual Question Answering (VQA) challenges. Our findings reveal GPT-4.1's remarkable capability to perform human-like image editing operations, particularly in single-image VQA scenarios. These operations encompass precise cropping, the addition of visual elements (including geometric shapes and textual annotations), and sophisticated image stylization through parameterized processing functions. Furthermore, in multi-image VQA contexts, the model demonstrates advanced reasoning capabilities, successfully generating code for complex operations such as subtracting two images in visual comparison tasks. We evaluate the pipeline in various vqa benchmarks and show its strong zero-shot performance.
                </p>
                <div class="project-links">
                    <a href="https://github.com/Agents-X/python-visual-primitive" class="project-link github">
                        <i class="fab fa-github"></i> Code
                    </a>
                    <a href="https://huggingface.co/Agents-X/python-visual-model" class="project-link huggingface">
                        <i class="fas fa-rocket"></i> Model
                    </a>
                    <a href="https://arxiv.org/abs/2306.12345" class="project-link arxiv">
                        <i class="fas fa-file-alt"></i> Report
                    </a>
                </div>
                
                <!-- authors -->
                <div class="authors-section">
                    <div class="authors-meta">
                        <div class="authors-title" style="text-align:left;">AUTHORS</div>
                        <div class="authors-list" style="text-align:left;">
                            <span class="author">Shitian Zhao<sup>*‡</sup></span>, 
                            <span class="author">Qilong Wu<sup>*</sup></span>, 
                            <span class="author">Haoquan Zhang<sup>*</sup></span>, 
                            <span class="author">Ming Li<sup>*</sup></span>, 
                            <span class="author">Shaoheng Lin<sup>*</sup></span>, 
                            <span class="author">Kaipeng Zhang</span>, 
                            <span class="author">Chen Wei</span>
                        </div>
                        <div class="author-note">‡ Project Lead;&nbsp;&nbsp;* Equal Contributing</div>
                    </div>
                    <div class="authors-right">
                        <div class="affiliations-title">AFFILIATIONS</div>
                        <div class="affiliations-list">Shanghai AI Lab, <br>Rice University</div>
                    </div>
                </div>
            </div>

            <div>
                <canvas id="VstarBench"></canvas>
            </div>

            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

            <h3 style="text-align: center; margin-bottom: 20px;">Evaluation on V* Bench</h3>
            <script>
            const ctx = document.getElementById('VstarBench');

            new Chart(ctx, {
                type: 'bar',
                data: {
                labels: [
                    'gpt-4o', 
                    'gpt-4.1', 
                    'gpt-4.1+tool (auto)', 
                    'gpt-4.1+tool (high)', 
                    'gpt-4.1+tool+imginfo',
                    'o3'
                ],
                datasets: [{
                    label: 'Acc - %',
                    data: [
                    55.5,    // gemini 2.5-pro-exp-03-25
                    55.0,   // gpt-4.1
                    70.2,   // gpt-4.1+tool (auto)
                    69.6,   // gpt-4.1+tool (high)
                    74.4,   // gpt-4.1+tool+imginfo
                    95.5    // o3
                    ],
                    backgroundColor: [
                    '#222',      // black
                    '#888',      // gray
                    '#ffb6b6',   // light red
                    '#ff8c8c',   // medium red
                    '#ff6b6b',   // red
                    '#ff4d4d'    // dark red
                    ],
                    borderWidth: 1
                }]
                },
                options: {
                // indexAxis 默认为 'x'，即纵向柱状图
                scales: {
                    y: {
                    beginAtZero: true,
                    max: 100,
                    title: {
                        display: true,
                        text: 'Accuracy (%)'
                    }
                    },
                    x: {
                    ticks: {
                        font: {
                        size: 14
                        }
                    }
                    }
                },
                plugins: {
                    legend: {
                    display: false
                    },
                    tooltip: {
                    callbacks: {
                        label: function(context) {
                        // 显示百分号
                        return context.parsed.y + '%';
                        }
                    }
                    }
                }
                }
            });
            </script>
            
            <nav class="section-nav">
                <a href="#introduction" class="section-link active">Introduction</a>
                <a href="#method" class="section-link">Method</a>
                <a href="#results" class="section-link">Results</a>
                <a href="#visual-puzzle" class="section-link">→ Visual-Puzzle</a>
                <a href="#geography" class="section-link">→ Geography</a>
                <a href="#medical" class="section-link">→ Medical</a>
                <a href="#science" class="section-link">→ Science</a>
                <a href="#information" class="section-link">→ Information</a>
                <a href="#conclusion" class="section-link">Conclusion</a>
                <a href="#bibtex" class="section-link">Bibtex</a>
                <a href="#references" class="section-link">References</a>
            </nav>

            <div class="article-content">
                <h2 id="introduction">Introduction</h2>
                <p>
                    This approach enables a new axis for test-time compute scaling that seamlessly
                    blends visual and textual reasoning, as reflected in their state-of-the-art
                    performance across multimodal benchmarks, marking a significant step toward
                    more natural, multimodal-capable AI systems.
                </p>
                
                <h2 id="method">Method</h2>
                <p>
                    Thinking with images allows you to interact with AI more easily. You can ask questions by taking
                    a photo without worrying about the positioning of objects—whether the text is upside down or 
                    there are multiple physics problems in one photo. Even if objects aren't obvious at first glance,
                    visual reasoning allows the model to zoom in to see more clearly.
                </p>
                
                <p class="note">All examples were completed with Agents-X visual model.</p>
                
                <h2 id="results">Results</h2>
                <p>
                    Our latest visual reasoning models work in tandem with other tools like Python data analysis,
                    web search, and image generation to creatively and effectively solve various tasks,
                    from educational questions to complex scientific challenges.
                </p>
                
                <!-- Dynamic category sections will be inserted here -->
                <div id="category-sections"></div>
                
                <h2 id="conclusion">Conclusion</h2>
                <p>
                    We are continuing to enhance our visual models with improved reasoning capabilities and
                    broader domain knowledge. Future versions will demonstrate even more sophisticated
                    understanding of complex visual inputs and better integration with programming tools.
                </p>

                <h2 id="bibtex">Bibtex</h2>
                <div class="bibtex-block">
                    <!-- <div class="bibtex-title">BibTeX Citation</div> -->
                    <pre class="bibtex-pre">@article{zhao2025pythonprimitive,
  title={Python is a good visual primitive},
  author={Zhao, Shitian and Wu, Qilong and Zhang, Haoquan and Li, Ming and Lin, Shaoheng and Zhang, Kaipeng and Wei, Chen},
  url={https://agents-x.space/python-visual-primitive.html},
  year={2025},
}</pre>
                    <!-- <button class="bibtex-copy-btn" onclick="copyBibtex()">Copy</button> -->
                </div>

                <h2 id="references">References</h2>
                <p>
                    [1] 
                </p>
            </div>
        </article>
    </main>

    <footer>
        <div class="container">
            <div class="copyright">
                <p>&copy; 2025 Agents-X. All rights reserved.</p>
                <p>Webpage designed by <a href="https://haoquanzhang.github.io" style="text-decoration: underline;">Haoquan Zhang</a> and <a href="https://github.com/sh-Lin" style="text-decoration: underline;">Shaoheng Lin</a></p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize section highlighting
            initSectionHighlight();
            // Load case data and create buttons
            loadCaseButtons();
        });
        
        function initSectionHighlight() {
            const sectionLinks = document.querySelectorAll('.section-nav .section-link');
            const sections = document.querySelectorAll('h1[id], h2[id], .feature-buttons[id]');
            
            // Highlight the current section on scroll
            function highlightSection() {
                const scrollPosition = window.scrollY + 100;
                
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    const sectionHeight = section.offsetHeight;
                    const sectionId = section.getAttribute('id');
                    
                    if (sectionId && 
                        scrollPosition >= sectionTop && 
                        scrollPosition < sectionTop + sectionHeight) {
                        
                        sectionLinks.forEach(link => {
                            link.classList.remove('active');
                            if (link.getAttribute('href') === `#${sectionId}`) {
                                link.classList.add('active');
                            }
                        });
                    }
                });
            }
            
            window.addEventListener('scroll', highlightSection);
            highlightSection(); // Run once on initial load
            
            // Smooth scrolling for section links
            sectionLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                        
                        // Update active state
                        sectionLinks.forEach(link => link.classList.remove('active'));
                        this.classList.add('active');
                    }
                });
            });
        }
        
        async function loadCaseButtons() {
            try {
                // Load the case metadata
                const casesResponse = await fetch('assets/trajectory_cases.json');
                
                if (!casesResponse.ok) {
                    throw new Error(`Failed to load cases data: ${casesResponse.status}`);
                }
                
                const casesData = await casesResponse.json();
                
                // Get the category sections container
                const categorySectionsContainer = document.getElementById('category-sections');
                categorySectionsContainer.innerHTML = '';
                
                // Create sections for each category
                const categories = Object.keys(casesData);
                
                categories.forEach((categoryName, categoryIndex) => {
                    const categorySection = document.createElement('div');
                    categorySection.className = 'category-section';
                    categorySection.innerHTML = `
                        <h3 id="${categoryName.toLowerCase()}" class="category-title">${categoryName}</h3>
                        <div class="feature-buttons category-buttons" id="buttons-${categoryName}"></div>
                        <div class="reasoning-process">
                            <div id="reasoning-container-${categoryName}" class="reasoning-container">
                                <div class="reasoning-loading">
                                    <div class="loading-spinner"></div>
                                    <p>Select a case to view the reasoning process...</p>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    categorySectionsContainer.appendChild(categorySection);
                    
                    // Create buttons for this category
                    const buttonsContainer = document.getElementById(`buttons-${categoryName}`);
                    const cases = casesData[categoryName];
                    
                    cases.forEach((caseInfo, caseIndex) => {
                        const button = document.createElement('button');
                        button.className = 'feature-button' + (caseIndex === 0 ? ' active' : '');
                        button.setAttribute('data-file-dir', caseInfo.file_dir);
                        button.setAttribute('data-category', categoryName);
                        button.textContent = caseInfo.show_name;
                        
                        button.addEventListener('click', function() {
                            // Remove active class from all buttons in this category
                            buttonsContainer.querySelectorAll('.feature-button').forEach(btn => {
                                btn.classList.remove('active');
                            });
                            // Add active class to clicked button
                            this.classList.add('active');
                            // Load the trajectory case
                            loadTrajectoryCase(this.getAttribute('data-file-dir'), this.getAttribute('data-category'));
                        });
                        
                        buttonsContainer.appendChild(button);
                    });
                    
                    // 自动加载第一个案例
                    if (cases.length > 0) {
                        loadTrajectoryCase(cases[0].file_dir, categoryName);
                    }
                });
                
            } catch (error) {
                console.error('Error loading case buttons:', error);
                const categorySectionsContainer = document.getElementById('category-sections');
                categorySectionsContainer.innerHTML = '<p>Error loading examples. Please try again later.</p>';
            }
        }
        
        async function loadTrajectoryCase(fileDir, category) {
            const container = document.getElementById(`reasoning-container-${category}`);
            container.innerHTML = `
                <div class="reasoning-loading">
                    <div class="loading-spinner"></div>
                <p>Loading visual reasoning process...</p>
                </div>
            `;
            try {
                // Load conversation from the specified directory
                const response = await fetch(`${fileDir}/conversations.json`);
                if (!response.ok) {
                    throw new Error(`Failed to load conversations: ${response.status}`);
                }
                const conversation = await response.json();
                renderConversation(conversation, container, fileDir);
            } catch (error) {
                console.error('Error loading conversation:', error);
                container.innerHTML = `
                    <div class="reasoning-error">
                        <div class="error-icon">⚠️</div>
                        <p>Error loading the reasoning process: ${error.message}</p>
                        <p>Please check the browser console for more details.</p>
                    </div>
                `;
            }
        }

        function renderConversation(conversation, container, fileDir) {
            container.innerHTML = '';
            conversation.forEach((msg, idx) => {
                const msgDiv = document.createElement('div');
                msgDiv.className = `reasoning-message reasoning-${msg.from}`;
                let value = msg.value;

                // 1. 先提取所有代码块，临时用占位符替换（统一用[[CODEBLOCK0]]格式）
                const codeBlocks = [];
                value = value.replace(/<code>\n```python\n([\s\S]*?)\n```\n<\/code>/g, (match, code) => {
                    codeBlocks.push(code);
                    return `[[CODEBLOCK${codeBlocks.length - 1}]]`;
                });

                // 2. 提取图片为占位符
                const imageBlocks = [];
                value = value.replace(/<image_clue_(\d+)>.*?<\/image_clue_\d+>/gs, (match, p1) => {
                    imageBlocks.push(p1);
                    return `[[IMAGEBLOCK${imageBlocks.length - 1}]]`;
                });

                // 3. 渲染interpreter输出 <interpreter>...</interpreter>
                value = value.replace(/<interpreter>([\s\S]*?)<\/interpreter>/g, (match, output) => {
                    if (output.includes('reasoning-image-wrap')) {
                        return `<div class="tag-indicator">&lt;interpreter&gt;</div><div class="reasoning-interpreter-output">${output}</div><div class="tag-indicator">&lt;/interpreter&gt;</div>`;
                    } else {
                        return `<div class="tag-indicator">&lt;interpreter&gt;</div><div class="reasoning-interpreter-output">${escapeHtml(output)}</div><div class="tag-indicator">&lt;/interpreter&gt;</div>`;
                    }
                });

                // 4. 渲染最终答案 <answer>...</answer>
                value = value.replace(/<answer>\n\\boxed{([\s\S]*?)}\n<\/answer>/g, (match, answer) => {
                    return `<div class="tag-indicator">&lt;answer&gt;</div><div class="reasoning-answer"><div class="answer-box">Final Answer: \\boxed{${escapeHtml(answer)}}</div></div><div class="tag-indicator">&lt;/answer&gt;</div>`;
                });

                // 5. 只对普通文本做换行和markdown处理
                value = value.replace(/\n/g, '<br>');
                value = value.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
                value = value.replace(/\*([^*]+)\*/g, '<em>$1</em>');
                value = value.replace(/__([^_]+)__/g, '<strong>$1</strong>');
                value = value.replace(/_([^_]+)_/g, '<em>$1</em>');

                // 6. 还原图片
                value = value.replace(/\[\[IMAGEBLOCK(\d+)\]\]/g, (match, idx) => {
                    const img = document.createElement('img');
                    img.src = `${fileDir}/images/image_${imageBlocks[idx]}.png`;
                    img.className = 'reasoning-image';
                    img.alt = `image_${imageBlocks[idx]}`;
                    img.onerror = function() {
                        this.onerror = null;
                        this.src = 'https://via.placeholder.com/600x400?text=Image+Load+Failed';
                    };
                    const wrap = document.createElement('div');
                    wrap.className = 'reasoning-image-wrap';
                    wrap.appendChild(img);
                    // 添加标识符并返回HTML字符串
                    return `<div class="tag-indicator">&lt;image_clue_${imageBlocks[idx]}&gt;</div>${wrap.outerHTML}<div class="tag-indicator">&lt;/image_clue_${imageBlocks[idx]}&gt;</div>`;
                });

                // 7. 还原代码块
                value = value.replace(/\[\[CODEBLOCK(\d+)\]\]/g, (match, idx) => {
                    return `<div class="tag-indicator">&lt;code&gt;</div><div class="reasoning-code"><pre><code class="language-python">${escapeHtml(codeBlocks[idx])}</code></pre></div><div class="tag-indicator">&lt;/code&gt;</div>`;
                });

                // 对话气泡样式
                const bubbleClass = msg.from === 'human' ? 'bubble-human' : 'bubble-gpt';
                msgDiv.innerHTML = `<div class="bubble ${bubbleClass}">${value}</div>`;
                container.appendChild(msgDiv);
            });
            // 代码高亮
            if (window.hljs) {
                container.querySelectorAll('pre code').forEach((block) => {
                    window.hljs.highlightBlock(block);
                });
            }
        }

        // HTML转义
        function escapeHtml(str) {
            return str.replace(/&/g, '&amp;')
                      .replace(/</g, '&lt;')
                      .replace(/>/g, '&gt;')
                      .replace(/"/g, '&quot;')
                      .replace(/'/g, '&#39;');
        }
    </script>
    
    <!-- Add highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
</body>
</html> 